<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualization</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link href="static/css/theme.css" rel="stylesheet" />
    <style>
      .legend {
        font-family: "Raleway", sans-serif;
        fill: #333333;
      }

      .tooltip {
        fill: #333333;
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container-fluid">
          <!-- Spotify logo and dashboard name -->
          <a class="navbar-brand" href="#">
              <img src="static/img/logo_black.png" alt="Spotify Logo" width="30" height="30" class="d-inline-block align-top" />
              Spotify Dashboard
          </a>
  
          <!-- Spacer to push content to the right -->
          <div class="ms-auto"></div>
  
          <!-- Date filter and BPM dropdown -->
          <div class="d-flex align-items-center">
              <!-- Date filter -->
              <div class="d-flex align-items-center me-2">
                  <label for="startDate" class="form-label">Start:</label>
                  <input type="date" class="form-control" id="startDate">
              </div>
              <div class="d-flex align-items-center me-2">
                  <label for="endDate" class="form-label">End:</label>
                  <input type="date" class="form-control" id="endDate">
              </div>
              <button type="button" class="btn btn-outline-success" onclick="applyDateFilter()">Apply</button>
  
              <!-- BPM Dropdown -->
              <div class="dropdown">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                      Select BPM
                  </button>
                  <ul class="dropdown-menu dropdown-menu-bpm" aria-labelledby="dropdownMenuButton1">
                      <!-- Sorted BPM values will be added here -->
                  </ul>
              </div>
              <div id="blinkingCircle" style="width: 20px; height: 20px; background-color: red; border-radius: 50%; display: inline-block;"></div>

          </div>
      </div>
  </nav>
  
  
    
    
    <div>
      <div id="barChart"></div>
      <!-- <div id="keyDonutChart"> </div> -->
      <div id="modesPieChart"></div>

      <div id="radarChart"></div>
      <div id="treemap"></div>
      <div id="bubbleChart"></div>
      <select id="dataSelect">
        <option value="playlist">Playlist</option>
        <option value="charts">Charts</option>
      </select>
      <div id="pcp"></div>
      <div id="percentage"></div>
      <div class="card">
        <p>Total Songs</p>
        <h1 id="songCount">Loading...</h1>  <!-- Placeholder text -->
      </div>
      <div class="card">
        <p>Sonority Index</p>
        <h1 id="sonorityindex">Loading...</h1>  <!-- Placeholder text -->
      </div>
    </div>

    <script>
      async function fetchSongCount() {
          const response = await fetch('/song_count');
          const data = await response.json();
          // console.log()
          document.getElementById('songCount').textContent = data.song_count.toLocaleString();  // Format number with commas
      }

      fetchSongCount();  // Call the function to update the count on load
      async function fetchSonorityIndex() {
          const response = await fetch('/sonority_index');
          const data = await response.json();
          // console.log('data')
          document.getElementById('sonorityindex').textContent = data.index.toLocaleString();  // Format number with commas
      }

      fetchSonorityIndex(); 
      const bpmValues = [65, 67, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 160, 161, 162, 163, 164, 165, 166, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 186, 188, 189, 192, 196, 198, 200, 202, 204, 206];
      const bpmMenu = document.querySelector('.dropdown-menu-bpm');
      const blinkingCircle = document.getElementById('blinkingCircle');
      const bpmButton = document.getElementById('dropdownMenuButton1'); // Button for displaying selected BPM

      bpmValues.forEach(value => {
          const item = document.createElement('li');
          const link = document.createElement('a');
          link.classList.add('dropdown-item');
          link.href = '#';
          link.textContent = value;
          link.addEventListener('click', function() {
              updateBlinkingSpeed(value);
              bpmButton.textContent = value + " BPM"; // Update the button text
              bpmButton.appendChild(document.createElement("span")).classList.add("caret");
          });
          item.appendChild(link);
          bpmMenu.appendChild(item);
      });

      let blinkingInterval = null;

      function updateBlinkingSpeed(bpm) {
          const blinkSpeed = 60000 / bpm;  // Milliseconds per blink (60,000 ms in a minute)
          
          if (blinkingInterval) clearInterval(blinkingInterval);
          
          blinkingInterval = setInterval(() => {
              blinkingCircle.style.visibility = blinkingCircle.style.visibility === 'hidden' ? 'visible' : 'hidden';
          }, blinkSpeed / 2);  // Divide by 2 because the interval controls the full cycle (hide and show)
      }
    </script>

    </script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script
      type="module"
      src="{{ url_for('static', filename='js/main.js')}}"
    ></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </body>
</html>
